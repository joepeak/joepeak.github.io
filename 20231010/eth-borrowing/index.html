<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="区块链,crypto,blockchain,AI,ai"><meta name="description" content="AI你的私人助理，区块链未来的世界，带你走向未来"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="baidu-site-verification" content="codeva-Mzo1I8aPpX"><meta name="referrer" content="no-referrer-when-downgrade"><title>以太坊上借贷协议的架构演变 | CryptoAI，未来世界的私人助理</title><meta name="generator" content="hexo-theme-ayer"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/dist/main.css"><link rel="stylesheet" href="/css/fonts/remixicon.css"><link rel="stylesheet" href="/css/custom.css"><script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-NJKHW32X"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-NJKHW32X")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?f4ca580d13bb1539f64fa4010ea88f00",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0],e=(t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}()</script><style>.swal2-styled.swal2-confirm{font-size:1.6rem}</style><link rel="alternate" href="/atom.xml" title="CryptoAI，未来世界的私人助理" type="application/atom+xml"></head></html><body><div id="app"><main class="content on"><section class="outer"><article id="post-eth-borrowing" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title sea-center" style="border-left:0" itemprop="name">以太坊上借贷协议的架构演变</h1></header><div class="article-meta"><a href="/20231010/eth-borrowing/" class="article-date"><time datetime="2023-10-10T08:52:32.000Z" itemprop="datePublished">2023-10-10</time></a><div class="word_count"><span class="post-time"><span class="post-meta-item-icon"><i class="ri-quill-pen-line"></i> <span class="post-meta-item-text">字数统计:</span> <span class="post-count">4.4k</span> </span></span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="ri-book-open-line"></i> <span class="post-meta-item-text">阅读时长≈</span> <span class="post-count">15 分钟</span></span></span></div></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><p>借贷是基于以太坊的区块链应用的基石。由于<a target="_blank" rel="noopener" href="https://dune.com/browse/dashboards?tags=Lending">数十亿资产被借出</a>，所以了解借贷的运作方式对于开发者、架构师或研究人员来说至关重要。</p><p>就像编程范式的演变一样，这些 DeFi 应用程序具有不同的架构设计，反映了从安全性到效率和用户体验等不断变化的优先事项。</p><p>此分析着眼于应用程序的架构，例如 MakerDAO、Compound、Aave、Euler 和 Yield。我们将重点介绍关键的创新和设计模式，它们是未来贷款应用程序开发的重要经验教训。</p><p>如果您是开发人员、架构师或安全研究人员，那么本文适合您。最后，您将轻松了解以太坊上的新借贷应用程序，快速而全面地掌握其架构。深入了解这些 DeFi 巨头是如何从头开始构建的。</p><p><img src="http://blockchain.szdyfjh.com/borrowing1.png" alt="借贷"></p><span id="more"></span><h2 id="DeFi-中的借贷"><a href="#DeFi-中的借贷" class="headerlink" title="DeFi 中的借贷"></a>DeFi 中的借贷</h2><p>大多数 DeFi 借贷是<a target="_blank" rel="noopener" href="https://www.investopedia.com/crypto-lending-5443191">超额抵押</a>。如果用户提供的抵押品价值高于贷款的价值，则用户可以借入特定资产。与传统贷款不同，许多此类贷款没有定期还款或固定结束日期。从本质上讲，你可以借，永远不还。</p><p>然而，有一个问题就是：<strong>抵押品的价值必须始终超过贷款价值预定的幅度</strong>。</p><p>如果抵押品价值低于此值，则贷款将会被<a target="_blank" rel="noopener" href="https://info.etherscan.com/explanation-on-defi-liquidation">清算</a>。在清算期间，其他人偿还您的部分或全部贷款，并且他们会收到您的部分或全部抵押品作为回报。</p><p>遵循这种财务结构的所有借款申请都需要相同的构建块，然后可以通过多种方式进行安排：</p><ul><li><p>存储用户抵押品和借入资产的金库</p></li><li><p>跟踪每个用户的抵押品和债务的会计系统</p></li><li><p>决定借款人利率的函数</p></li><li><p>验证贷款是否有足够抵押的机制，通常涉及外部价格预言机</p></li><li><p>抵押不足贷款的清算路径</p></li><li><p>记录借贷总额和其他安全指标的风险管理系统，例如全球和每个用户的借贷限额、最低抵押品和特定的超额抵押率</p></li><li><p>供用户添加和删除抵押品、借贷和偿还标的物的界面</p></li></ul><p><img src="http://blockchain.szdyfjh.com/borrowing2.png" alt="MakerDAO 中的借贷流程，所有应用程序共享相同的步骤和功能"></p><p>借款和贷款可以被视为独立的功能。在 DeFi 中，我们在大多数借贷应用程序中都发现了这两种功能，但它们并不总是能够很好地集成。 在Compound中，Aave和Euler就是这样。借款人和贷款人的利率是内部相关的；事实上，这就是使这些应用程序以最少的干预运行的原因。</p><p>另一方面，MakerDAO 和 Yield是他们借给借款人的资产的发起者。</p><p>他们不要求用户提供资产以便其他用户可以借用。</p><p>本文将重点讨论链上借款，并在很大程度上忽略贷款。由于抵押要求，借款要复杂得多，并且了解借款模式通常可以更好地理解整个协议。</p><h2 id="MakerDAO-的架构演变"><a href="#MakerDAO-的架构演变" class="headerlink" title="MakerDAO 的架构演变"></a>MakerDAO 的架构演变</h2><p><a target="_blank" rel="noopener" href="https://github.com/makerdao/dss">MakerDAO</a>，于 2019 年 11 月<a target="_blank" rel="noopener" href="https://blog.makerdao.com/multi-collateral-dai-is-live">推出</a>，它持有$4.95B 抵押品。尽管其模块化架构具有针对每个功能的不同合同和独特的术语，但它仍然易于理解和验证。</p><p>MakerDAO 中的国库功能由<a target="_blank" rel="noopener" href="https://github.com/makerdao/dss/blob/master/src/join.sol">加入合约</a>管理。</p><p>每个被批准作为抵押资产的代币都有一个<a target="_blank" rel="noopener" href="https://changelog.makerdao.com/releases/mainnet/1.12.0/contracts.json">单独的合约</a>。</p><p>MakerDAO 不拥有任何借贷资产 DAI。它只是根据需要<a target="_blank" rel="noopener" href="https://github.com/makerdao/dss/blob/fa4f6630afb0624d04a003e920b0d71a00331d98/src/join.sol#L172">铸造和销毁</a> DAI。</p><p>Accounting 在 <a target="_blank" rel="noopener" href="https://github.com/makerdao/dss/blob/master/src/vat.sol">vat.sol 合约</a>内处理。当抵押品进入或退出系统时，Join 会更新此<a target="_blank" rel="noopener" href="https://github.com/makerdao/dss/blob/fa4f6630afb0624d04a003e920b0d71a00331d98/src/join.sol#L111">合约</a>。如果用户借款，他们会直接与 <a target="_blank" rel="noopener" href="https://github.com/makerdao/dss/blob/fa4f6630afb0624d04a003e920b0d71a00331d98/src/vat.sol#L143">vat.sol 合约</a>进行交互。</p><p>此操作会更新用户的债务余额，并允许他们在 DAI 中铸造 DAI。</p><p>为了偿还，用户在 DAI Join中燃烧 DAI。然后，此过程会更新增值税，使用户能够结清贷款。</p><p>此外， vat.sol合约充当<a target="_blank" rel="noopener" href="https://github.com/makerdao/dss/blob/fa4f6630afb0624d04a003e920b0d71a00331d98/src/vat.sol#L160">风险管理</a>引擎。它维持全部借贷限额，设定每个用户的最低阈值，并监督抵押比率。当用户的债务或抵押品余额发生变化时，vat.sol 合约会评估利率和现货。</p><p>这些是指基于所使用的抵押品和现行 DAI 与抵押品价格比率的利率。有趣的是，这些值由其他 MakerDAO 合约输入到 vat.sol 合约中，这种方法与大多数其他应用程序不同。</p><p>MakerDAO 在设计阶段就将安全放在首位——当时 gas成本等因素是次要的，用户体验是次要问题，竞争也可以忽略不计。</p><p>因此，它可能会显得古怪、使用成本高昂且难以驾驭。</p><p>然而，其管理的庞大资产和没有重大违规行为的运营记录凸显了其稳健的设计和执行。</p><p>MakerDAO强调：</p><ul><li><p>每个资产在最大利差资金功能中都有自己的合约</p></li><li><p>会计功能集中在单个合同中，该合同还记录和执行风险参数，包括抵押检查</p></li><li><p>与其他应用程序不同，预言机更新合约，监督抵押</p></li><li><p>价格和利率预言机利用不同的接口</p></li><li><p>利率源自外部</p></li><li><p>要借款，用户必须与多个合约交互</p></li></ul><h2 id="Yield-协议的架构演变"><a href="#Yield-协议的架构演变" class="headerlink" title="Yield 协议的架构演变"></a>Yield 协议的架构演变</h2><p><a target="_blank" rel="noopener" href="https://github.com/yieldprotocol/fyDai">Yield v1</a> 作为使用 <a target="_blank" rel="noopener" href="https://yield.is/YieldSpace.pdf">YieldSpace</a> 的固定利率的概念证明。该版本在 MakerDAO 之上构建了其抵押债务引擎。然而，Yield v1 使用起来既昂贵又难以通过新功能进行增强。</p><p>认识到 YieldSpace 的潜力后，我们迅速转向开发 <a target="_blank" rel="noopener" href="https://yieldprotocol.com/">Yield v2</a>。Yield v2 仍从 MakerDAO 中汲取灵感，但现已完全独立，于 2021 年 10 月<a target="_blank" rel="noopener" href="https://medium.com/yield-protocol/yield-protocol-v2-is-live-in-beta-cf547f18cb5f">推出</a>； Yield v2 优先考虑降低 Gas 成本和增强用户体验。</p><p><img src="http://blockchain.szdyfjh.com/borrowing3.png" alt="Yield v2 中的借贷流程深受 MakerDAO 影响"></p><p>所有会计、风险管理和抵押检查都合并到一份合同中：<a target="_blank" rel="noopener" href="https://github.com/yieldprotocol/vault-v2/blob/master/src/Cauldron.sol">The Cauldron</a>。效仿 MakerDAO 的方法，我们将国库功能分布在 <a target="_blank" rel="noopener" href="https://github.com/yieldprotocol/vault-v2/blob/master/src/Join.sol">Join 合约</a>中，每个合约专用于一项特定资产。</p><p>我们改进了预言机集成，将价格和利率预言机合并为一个<a target="_blank" rel="noopener" href="https://github.com/yieldprotocol/vault-v2/blob/master/src/interfaces/IOracle.sol">通用接口</a>。我们反转了 MakerDAO 的预言机流程，以便 <a target="_blank" rel="noopener" href="https://github.com/yieldprotocol/vault-v2/blob/a8c7587a01fd7c0e0df042932fa14584e28ad88b/src/Cauldron.sol#L362">Cauldron</a> 根据抵押检查的需要查阅预言机。据我所知，这是除 MakerDAO 之外的所有地方的首选流程。</p><p>与 MakerDAO 方法的另一个重大差异是我们引入了<a target="_blank" rel="noopener" href="https://github.com/yieldprotocol/vault-v2/blob/master/src/Ladle.sol">Ladle</a>。该合约充当用户和 Yield 之间的唯一中介。它对财务和会计拥有广泛的控制权，但作为回报，它为功能开发提供了巨大的灵活性。</p><p>总而言之，Yield v2 中的借贷工作原理如下：</p><ul><li><p>每项资产都有自己专用的财务合约，确保财务功能的最大分配。</p></li><li><p>单一合同集中了会计职能。该合同还监督风险管理措施并执行抵押检查。</p></li><li><p>抵押功能咨询预言机来确定价格和利率。</p></li><li><p>价格和利率预言机共享统一的界面。</p></li><li><p>利率是外部产生的。</p></li><li><p>用户可以通过向一份合约发出单个请求来借款。</p></li></ul><h2 id="Compound-的架构演变"><a href="#Compound-的架构演变" class="headerlink" title="Compound 的架构演变"></a>Compound 的架构演变</h2><p><a target="_blank" rel="noopener" href="https://github.com/compound-finance/compound-money-market">Compound 的第一个版本</a>是<a target="_blank" rel="noopener" href="https://medium.com/compound-finance/compound-launches-money-markets-for-ethereum-assets-f50920f04488">概念验证</a>，表明可以在以太坊上建立货币市场。因此，其设计优先考虑简单性。 <a target="_blank" rel="noopener" href="https://github.com/compound-finance/compound-money-market/blob/241541a62d0611118fb4e7eb324ac0f84bb58c48/contracts/MoneyMarket.sol?ref=hackernoon.com">MoneyMarket.sol</a>合约封装了所有功能，包括贷款。</p><p><img src="http://blockchain.szdyfjh.com/borrowing4.png" alt="Compound v1 中的借用过程。简单而有效"></p><ul><li><p>财务、会计和风险管理任务（例如抵押检查）被合并到一份合同中。</p></li><li><p>该合约从预言机检索价格，但根据资产利用率确定利率。</p></li><li><p>用户仅与该合约交互，尽管他们必须单独调用来提供抵押品和借入资产。</p></li></ul><h3 id="Compound-v2"><a href="#Compound-v2" class="headerlink" title="Compound v2"></a>Compound v2</h3><p><a target="_blank" rel="noopener" href="https://medium.com/compound-finance/compound-v2-is-live-157db0b7cfc8">Compound v2</a> 于 2019 年 5 月推出，点燃了流动性挖矿时代，激发了无数分叉。它也起到货币市场的作用，允许用户借出和借入资产。</p><p>基于其<a target="_blank" rel="noopener" href="https://compound.finance/documents/Compound.Whitepaper.pdf">白皮书</a>和结构，很明显，Compound v2 的主要目标是使用 ERC20 标准来表示借贷头寸。这确保了可组合性，允许用户借给Compound，然后在其他区块链应用程序中使用这些计息头寸。</p><p>有趣的是，白皮书并没有强调Compound v2 将<a target="_blank" rel="noopener" href="https://github.com/compound-finance/compound-protocol/blob/a3214f67b73310d547e00fc578e8355911c9d376/contracts/Comptroller.sol#L246">奖励</a>纳入其智能合约中。鉴于这一遗漏，该功能的巨大影响可能无法预见。</p><p><img src="http://blockchain.szdyfjh.com/borrowing5.png" alt="Compound v2 中的借用过程。首次涉足代币化借贷头寸"></p><ul><li><p>每项资产都有自己的资金合约，最大化资金功能的分配。</p></li><li><p>记账功能也是分布式的，每个 cToken 都会记录用户的抵押品和债务。</p></li><li><p>单一合约（审计员）记录并执行风险管理参数，包括抵押检查。</p></li><li><p>负责抵押检查的合约参考价格的预言机和利率的 cToken。</p></li><li><p>价格和利率预言机通过不同的接口运行。</p></li><li><p>利率内部源自资产利用率。</p></li><li><p>用户必须与多个合约交互才能借款。</p></li></ul><h3 id="Compound-v3"><a href="#Compound-v3" class="headerlink" title="Compound v3"></a>Compound v3</h3><p><a target="_blank" rel="noopener" href="https://github.com/compound-finance/comet">Compound v3</a> 于 2022 年<a target="_blank" rel="noopener" href="https://medium.com/compound-finance/compound-iii-is-live-a7983dee7e60">发布</a>，采用了更为保守的风险管理策略，将流动性隔离到每个可借资产的<a target="_blank" rel="noopener" href="https://github.com/compound-finance/comet/blob/22cf923b6263177555272dde8b0791703895517d/contracts/Comet.sol">池</a>中。该设计还揭示了对用户友好性和天然气成本的担忧。</p><p><img src="http://blockchain.szdyfjh.com/borrowing6.png" alt="Compound v3 (Comet) 中的借用过程。回到基础，回到安全。不过，有了更好的用户体验。"></p><p>由于所需调用次数的减少，该系统对于开发人员和用户来说都更加直观。此外，单一合约设计通过最大限度地减少合约之间的调用来降低天然气成本。隔离的货币市场是对基于预言机的攻击的防御，这现在是一个主要的安全问题。</p><p>文中提到的其他相关功能发行说明包括：</p><ul><li><p>彻底改造的风险管理和清算引擎。这种设计增强了资金安全性，同时对借款人更加友好。</p></li><li><p>在整个市场上对个人抵押资产设置限制以降低风险。</p></li><li><p>收入和借款的利率模型现在是分开的，治理对经济政策具有完全控制权。</p></li></ul><p>有趣的是，Compound v3 镜像了Compound v1 的架构，让单个合约处理每个可借资产的所有功能。其他值得注意的功能包括：</p><ul><li><p>只能借出资产；抵押资产不能。</p></li><li><p>在Compound v3 中，抵押品不会产生回报。</p></li></ul><p>禁止借用抵押品提高了抵押品存入者的安全性。这降低了治理错误或故意攻击危及抵押品的可能性。</p><p>消除所提供抵押品的回报可能是由于Compound 设法在 v2 中积累了大量流动性的结果。我的直觉是，在Compound v2 中，借贷限额要么低于或不高于用户借给应用程序的资产。</p><p>假设他们将管理 v3 类似水平的流动性，禁止借出抵押品可以使应用程序安全，这是 v3 的核心目标之一。</p><p>从架构的角度来看：</p><ul><li><p>每个货币市场都是一份包含财务、会计和风险管理的单独合同</p></li><li><p>每个货币市场都保留可借资产及其所有批准的抵押资产代币，从而导致资产分散在整个应用程序中</p></li><li><p>价格反馈是唯一的外部输入；借贷利率由内部产生</p></li><li><p>供给/提现/借用/还款等传统功能得到巧妙整合。现在，从货币市场提取可借资产意味着借款，而提供可借资产则意味着根据用户的债务进行偿还或贷款</p></li><li><p>集成了路由合约，允许在一次调用中执行多个操作</p></li></ul><h2 id="Aave-的架构演变"><a href="#Aave-的架构演变" class="headerlink" title="Aave 的架构演变"></a>Aave 的架构演变</h2><p><a target="_blank" rel="noopener" href="https://github.com/aave/aave-protocol">Aave v1</a> 于 2019 年 10 月<a target="_blank" rel="noopener" href="https://github.com/aave/aave-protocol/blob/master/docs/Aave_Protocol_Whitepaper_v1_0.pdf">推出</a>，接替 ETHLend。 Aave v1 引入了共享流动性池，而不是 ETHLend 的点对点方法。</p><p><img src="http://blockchain.szdyfjh.com/borrowing7.png" alt="Aave v1 中的借用过程。汇集流动性意味着财务和计算效率。"></p><p>正如在 Yield v2 中一样， <a target="_blank" rel="noopener" href="https://github.com/aave/aave-protocol/blob/4b4545fb583fd4f400507b10f3c3114f45b8a037/contracts/lendingpool/LendingPool.sol">路由器合约</a>还掌握了业务逻辑。<a target="_blank" rel="noopener" href="https://github.com/aave/aave-protocol/blob/4b4545fb583fd4f400507b10f3c3114f45b8a037/contracts/lendingpool/LendingPoolCore.sol">LendingPoolCore</a> 实现了会计、风险管理和财务功能。将资金集中在一个合约中是与Compound v2 的一个区别点。</p><p>将抵押检查留在<a target="_blank" rel="noopener" href="https://github.com/aave/aave-protocol/blob/4b4545fb583fd4f400507b10f3c3114f45b8a037/contracts/lendingpool/LendingPoolDataProvider.sol">自己的合约</a>中（从路由器而不是会计合约调用）的决定似乎很弱，但它可能适合目的，因为 Aave v2 在 v1 发布两年后才发布。</p><ul><li><p>LendingPoolCore 合约处理财务和会计</p></li><li><p>LendingPoolDataProvider 管理抵押检查并与预言机交互</p></li><li><p>LendingPool作为用户入口并实现业务逻辑</p></li><li><p>借贷利率由内部决定，仅依赖于价格反馈</p></li></ul><h3 id="Aave-v2"><a href="#Aave-v2" class="headerlink" title="Aave v2"></a>Aave v2</h3><p><a target="_blank" rel="noopener" href="https://github.com/aave/protocol-v2">Aave v2</a> 于 2021 年 12 月[发布](<a target="_blank" rel="noopener" href="https://medium.com/aave/the-aave-protocol-v2-f06f299cee04]%E3%80%82%E8%99%BD%E7%84%B6%E5%AE%83%E4%BF%9D%E7%95%99%E4%BA%86%E4%B8%8E">https://medium.com/aave/the-aave-protocol-v2-f06f299cee04]。虽然它保留了与</a> Aave v1 类似的功能，但与 Aave v1 和 Compound v2 相比，它引入了改进且更简单的架构。在此版本中，Aave 还引入了 [aToken](<a target="_blank" rel="noopener" href="https://github.com/aave/protocol-v2/blob/ce53c4a8c8620125063168620eba0a8a92854eb8/contracts/protocol/tokenization/AToken.sol]%EF%BC%88%E7%B1%BB%E4%BC%BC%E4%BA%8ECompound">https://github.com/aave/protocol-v2/blob/ce53c4a8c8620125063168620eba0a8a92854eb8/contracts/protocol/tokenization/AToken.sol]（类似于Compound</a> 的 cToken）和 <a target="_blank" rel="noopener" href="https://github.com/aave/protocol-v2/blob/ce53c4a8c8620125063168620eba0a8a92854eb8/contracts/protocol/tokenization/VariableDebtToken.sol">vToken</a>，它们代表代币化债务。</p><p><img src="http://blockchain.szdyfjh.com/borrowing8.png" alt="Aave v2 具有非常干净的架构，完全标记化。"></p><p>为了简单起见，省略了 Aave v1 中使用有限的某些功能。 Aave v1 中的问题（例如应计利息的复杂表示）已在 Aave v2 中得到解决。</p><ul><li><p>LendingPool 合约整合了全球会计和风险管理功能，例如抵押检查。它作为用户的主要访问点</p></li><li><p>aToken 表示抵押品，类似于借贷头寸。用户的抵押品通过其持有的 aToken 体现，金库功能分布在所有 aToken 上</p></li><li><p>vToken 用于表示债务头寸。用户的债务由他们持有的 vToken 表示</p></li></ul><h3 id="Aave-v3"><a href="#Aave-v3" class="headerlink" title="Aave v3"></a>Aave v3</h3><p><a target="_blank" rel="noopener" href="https://github.com/aave/aave-v3-core">Aave v3</a> 于 2023 年 1 月<a target="_blank" rel="noopener" href="https://aave.mirror.xyz/K9gQPsv-hAH-gO4oH2i0Oen8uQEHYL5q8x9xjN9XnmA">发布</a>，具有多链支持和其他功能。这些添加不会改变核心架构。此次更新还改进了风险管理和天然气效率。</p><p>尽管有许多进步，但就本研究而言，Aave v3 与 Aave v2 并没有本质上的不同。事实上，这可能表明 Aave v2 的架构在 2023 年仍然保持稳健。</p><h2 id="Euler-的架构演变"><a href="#Euler-的架构演变" class="headerlink" title="Euler 的架构演变"></a>Euler 的架构演变</h2><p><a target="_blank" rel="noopener" href="https://github.com/euler-xyz/euler-contracts">Euler</a> 于 2022 年 12 月<a target="_blank" rel="noopener" href="https://www.euler.finance/blog/euler-launches-on-mainnet">推出</a>，旨在为货币市场提供无需许可的功能和最少的治理。</p><p>其设计的一个标志是<a target="_blank" rel="noopener" href="https://eips.ethereum.org/EIPS/eip-2535">钻石</a>般的模式。<a target="_blank" rel="noopener" href="https://github.com/euler-xyz/euler-contracts/blob/dfaa7788b17ac7c2a826a3ed242d7181998a778f/contracts/Storage.sol">单个合约拥有应用程序的所有存储空间</a>。该存储可以通过不同的<a target="_blank" rel="noopener" href="https://github.com/euler-xyz/euler-contracts/tree/dfaa7788b17ac7c2a826a3ed242d7181998a778f/contracts/modules">代理</a>进行访问，每个代理管理系统的不同概念元素。</p><p><img src="http://blockchain.szdyfjh.com/borrowing9.png" alt="Euler"></p><p>尽管一份合约存储了所有资产、会计和风险管理数据，但仍然有用于抵押品和借贷的 eToken，以及用于债务的 dToken，类似于 Aave v2。然而，这些代币合约仅仅是中央存储合约的视图。</p><ul><li><p><a target="_blank" rel="noopener" href="https://github.com/euler-xyz/euler-contracts/blob/dfaa7788b17ac7c2a826a3ed242d7181998a778f/contracts/Storage.sol">存储合约</a>管理会计变量。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/euler-xyz/euler-contracts/blob/dfaa7788b17ac7c2a826a3ed242d7181998a778f/contracts/BaseLogic.sol">BaseLogic 合约</a>充当金库。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/euler-xyz/euler-contracts/blob/dfaa7788b17ac7c2a826a3ed242d7181998a778f/contracts/modules/RiskManager.sol">RiskManager 合约</a>监督风险管理变量和功能，包括抵押检查。</p></li></ul><p>对代码的分析表明，最小的天然气成本是首要任务，从而导致整体设计消除了合约间调用的需要。通过严格的测试和审核确保了安全性。只有逻辑分布在各个模块中，作为存储合约的实现，存储合约主要充当代理合约。</p><p>这种统一的设计还支持轻松升级。如果不需要更改存储，则可以快速更换模块以修改或引入功能。</p><p>Euler 在发布 15 个月后以及升级引入该漏洞后 6 个月后遭到黑客攻击。</p><p>我不认为整体架构在资产流失中发挥了作用；相反，对代码更新的监督不够。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>MakerDAO、Compound 和 Aave 等早期以太坊应用程序展示了以太坊超额抵押借贷的潜力。一旦这些概念验证被证明是成功的，重点就转移到引入一系列新功能以占领市场份额。 Compound 和 Aave 的后续版本引入了流动性挖矿、可组合性和集合流动性，这些技术在牛市条件下尤其蓬勃发展。</p><p>一个重大发展是 Compound v2引入了代币化借贷头寸，这使得这些头寸能够被其他应用程序识别为标准资产。 Aave v2 和 Euler 通过实施代币化债务头寸更进一步，其更广泛的效用仍然是一个争论的话题。</p><p>高 Gas 成本成为牛市期间的主要问题，促使用户体验发生变化，如 Yield v2、Aave v2 和 Euler 所示。路由器合约和整体实施有助于降低用户的交易成本。然而，这是以更复杂、因此风险更大的代码为代价的。</p><p>Compound v3 似乎开创了先例，将安全性置于财务效率之上。它偏离了传统的流动性池模型，以更好地防范潜在的黑客攻击。 L2 网络的兴起（其中 Gas 成本变得越来越可以忽略不计）可能会影响未来抵押借款应用程序的设计。</p><p>在本文中，我全面概述了以太坊上的关键抵押借款应用程序。我用来分析每个申请的方法也可以用于快速掌握其他抵押借款申请的复杂性。</p><p>在开发区块链借贷应用程序时，请始终考虑资产的存储、会计记录的放置以及风险和抵押品评估的方法。当您考虑这些注意事项时，请利用以前应用程序的历史记录以及本概述中的见解来为您的决策提供信息。</p><h2 id="联系"><a href="#联系" class="headerlink" title="联系"></a>联系</h2><p>有兴趣一起研究CA，可以扫描下面二维码入群交流。</p><img decoding="async" src="/images/wechat-group.png" width="33%"><div id="reword-out"><div id="reward-btn">打赏</div></div></div><div class="declare"><ul class="post-copyright"><li><i class="ri-copyright-line"></i> <strong>版权声明： </strong>本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！</li></ul></div><footer class="article-footer"><div class="share-btn"><span class="share-sns share-outer"><i class="ri-share-forward-line"></i> 分享</span><div class="share-wrap"><i class="arrow"></i><div class="share-icons"><a class="weibo share-sns" href="javascript:;" data-type="weibo"><i class="ri-weibo-fill"></i> </a><a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin"><i class="ri-wechat-fill"></i> </a><a class="qq share-sns" href="javascript:;" data-type="qq"><i class="ri-qq-fill"></i> </a><a class="douban share-sns" href="javascript:;" data-type="douban"><i class="ri-douban-line"></i> </a><a class="facebook share-sns" href="javascript:;" data-type="facebook"><i class="ri-facebook-circle-fill"></i> </a><a class="twitter share-sns" href="javascript:;" data-type="twitter"><i class="ri-twitter-fill"></i> </a><a class="google share-sns" href="javascript:;" data-type="google"><i class="ri-google-fill"></i></a></div></div></div><div class="wx-share-modal"><a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a><p>扫一扫，分享到微信</p><div class="wx-qrcode"><img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://www.cryptoai.fans/20231010/eth-borrowing/" alt="微信分享二维码"></div></div><div id="share-mask"></div><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/defi/" rel="tag">defi</a></li></ul></footer></div><nav class="article-nav"><a href="/20230924/gpt-embeddings/" class="article-nav-link"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">GPT 应用开发和思考</div></a></nav><div id="vcomments-box"><div id="vcomments"></div></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.staticfile.org/valine/1.4.16/Valine.min.js"></script><script>new Valine({el:"#vcomments",app_id:"jTgwNa8LqrJW9NFiPPlB10D5-gzGzoHsz",app_key:"CAOP7YrhhC4eyJe8QPngjVAC",path:window.location.pathname,avatar:"monsterid",placeholder:"给我的文章加点评论吧~",recordIP:!0});const infoEle=document.querySelector("#vcomments .info");infoEle&&infoEle.childNodes&&0<infoEle.childNodes.length&&infoEle.childNodes.forEach(function(e){e.parentNode.removeChild(e)})</script><style>#vcomments-box{padding:5px 30px}@media screen and (max-width:800px){#vcomments-box{padding:5px 0}}#vcomments-box #vcomments{background-color:#fff}.v .vlist .vcard .vh{padding-right:20px}.v .vlist .vcard{padding-left:10px}</style><script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script><div id="twikoo" class="twikoo"></div><script>twikoo.init({envId:""})</script></article></section><footer class="footer"><div class="outer"><ul><li>Copyrights &copy; 2023 <i class="ri-heart-fill heart_icon"></i> Qiao Feng</li></ul><ul><li></li></ul><ul><li><span><span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span> <span class="division">|</span> <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span></span></li></ul><ul></ul><ul></ul><ul><li></li></ul><ul><li><span id="runtime_span"></span></li></ul><script type="text/javascript">function show_runtime(){window.setTimeout("show_runtime()",1e3),X=new Date("09/13/2023 22:22:22"),Y=new Date,T=Y.getTime()-X.getTime(),M=864e5,a=T/M,A=Math.floor(a),b=24*(a-A),B=Math.floor(b),c=60*(b-B),C=Math.floor(60*(b-B)),D=Math.floor(60*(c-C)),runtime_span.innerHTML="小站在各种崩坏中坚持了: "+A+"天"+B+"小时"+C+"分"+D+"秒"}show_runtime()</script></div></footer></main><div class="float_btns"><div class="totop" id="totop"><i class="ri-arrow-up-line"></i></div><div class="todark" id="todark"><i class="ri-moon-line"></i></div></div><aside class="sidebar on"><button class="navbar-toggle"></button><nav class="navbar"><div class="logo"><a href="/"><img src="/images/logo.webp" alt="CryptoAI，未来世界的私人助理"></a></div><ul class="nav nav-main"><li class="nav-item"><a class="nav-item-link" href="/">主页</a></li><li class="nav-item"><a class="nav-item-link" href="/archives">归档</a></li><li class="nav-item"><a class="nav-item-link" href="/categories">分类</a></li><li class="nav-item"><a class="nav-item-link" href="/tags">标签</a></li><li class="nav-item"><a class="nav-item-link" href="/tags/invest">投资</a></li><li class="nav-item"><a class="nav-item-link" href="/other/">其他</a></li><li class="nav-item"><a class="nav-item-link" href="/friends">友链</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="ri-search-line"></i> </a><a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed"><i class="ri-rss-line"></i></a></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"><input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><div id="mask"></div><div id="reward"><span class="close"><i class="ri-close-line"></i></span><p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p><div class="reward-box"><div class="reward-item"><img class="reward-img" src="/images/alipay.png"> <span class="reward-type">支付宝</span></div><div class="reward-item"><img class="reward-img" src="/images/wechat.png"> <span class="reward-type">微信</span></div></div></div><script src="/js/jquery-3.6.0.min.js"></script><script src="/js/lazyload.min.js"></script><script src="/js/tocbot.min.js"></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,scrollContainer:"main",positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"><script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script><script src="/dist/main.js"></script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css"><script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script><script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script><script>function viewer_init(){let i=document.querySelectorAll(".pswp")[0],r=document.querySelectorAll(".article-entry img:not(.reward-img)");r.forEach((t,e)=>{t.onclick=()=>{if(!document.querySelector(".left-col.show")){let o=[];r.forEach((t,e)=>{t.getAttribute("data-idx",e);var e=t.getAttribute("data-target")||t.getAttribute("src"),i=t.getAttribute("alt"),r=new Image;r.src=e,o.push({src:e,w:r.width||t.width,h:r.height||t.height,title:i})}),new PhotoSwipe(i,PhotoSwipeUI_Default,o,{index:parseInt(e)}).init()}}})}viewer_init()</script><script src="/js/busuanzi-2.3.pure.min.js"></script><link rel="stylesheet" href="/css/clipboard.css"><script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script><script>function wait(e,i){window.setTimeout(e,i)}!function(){var e;e="",e+='<button class="btn-copy" data-clipboard-snippet=""><i class="ri-file-copy-2-line"></i><span>COPY</span></button>',$(".highlight .code pre").before(e),$(".article pre code").before(e),(e=new ClipboardJS(".btn-copy",{target:function(e){return e.nextElementSibling}})).on("success",function(e){e=$(e.trigger);e.addClass("copied");let i=$(e.find("i")),n=(i.removeClass("ri-file-copy-2-line"),i.addClass("ri-checkbox-circle-line"),$(e.find("span")));n[0].innerText="COPIED",wait(function(){i.removeClass("ri-checkbox-circle-line"),i.addClass("ri-file-copy-2-line"),n[0].innerText="COPY"},2e3)}),e.on("error",function(e){e.clearSelection();e=$(e.trigger);e.addClass("copy-failed");let i=$(e.find("i")),n=(i.removeClass("ri-file-copy-2-line"),i.addClass("ri-time-line"),$(e.find("span")));n[0].innerText="COPY FAILED",wait(function(){i.removeClass("ri-time-line"),i.addClass("ri-file-copy-2-line"),n[0].innerText="COPY"},2e3)})}((window,document))</script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></div></body>